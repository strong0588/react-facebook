{"version":3,"sources":["../src/Profile.jsx"],"names":["Profile","state","loading","handleReady","api","updateProfile","handleStatusChange","fields","props","getLoginStatus","response","status","LoginStatus","CONNECTED","setState","profile","undefined","error","getProfile","render","children","Component","defaultProps","Fields"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;IAaqBA,O;;;;;;;;;;;;;;0JAKnBC,K,GAAe;AACbC,eAAS;AADI,K,QAIfC,W;0FAAc,iBAAOC,GAAP;AAAA;AAAA;AAAA;AAAA;AACZ,sBAAKA,GAAL,GAAWA,GAAX;;AAEA,sBAAKC,aAAL;;AAHY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;eAMdC,kB,GAAqB,YAAY;AAC/B,YAAKD,aAAL;AACD,K;;;oBAEKA,a;;;;;;;;AACID,iB,GAA2B,I,CAA3BA,G,EAAcG,M,GAAa,I,CAAtBC,K,CAASD,M;;kBACjBH,G;;;;;;;;;;qBAKoBA,IAAIK,cAAJ,E;;;AAAjBC,sB;;oBACFA,SAASC,MAAT,KAAoBC,sBAAYC,S;;;;;AAClC,mBAAKC,QAAL,CAAc;AACZC,yBAASC,SADG;AAEZd,yBAAS,KAFG;AAGZe,uBAAOD;AAHK,eAAd;;;;;;qBASoBZ,IAAIc,UAAJ,CAAe;AACnCX;AADmC,eAAf,C;;;AAAhBQ,sB;;;AAIN,mBAAKD,QAAL,CAAc;AACZC,iCADY;AAEZb,yBAAS,KAFG;AAGZe,uBAAOD;AAHK,eAAd;;;;;;;;AAMA,mBAAKF,QAAL,CAAc;AACZC,yBAASC,SADG;AAEZd,yBAAS,KAFG;AAGZe;AAHY,eAAd;;;;;;;;;;;;;;;;;oBAQJE,M,qBAAS;AAAA,QACCC,QADD,GACc,KAAKZ,KADnB,CACCY,QADD;AAAA,iBAE6B,KAAKnB,KAFlC;AAAA,QAECc,OAFD,UAECA,OAFD;AAAA,QAEUb,OAFV,UAEUA,OAFV;AAAA,QAEmBe,KAFnB,UAEmBA,KAFnB;;;AAIP,WACE;AAAC,0BAAD;AAAA,QAAY,SAAS,KAAKd,WAA1B;AACE;AAAC,2BAAD;AAAA,UAAW,OAAM,mBAAjB,EAAqC,UAAU,KAAKG,kBAApD;AACGc,iBAAS;AACRL,0BADQ;AAERb,0BAFQ;AAGRe;AAHQ,SAAT;AADH;AADF,KADF;AAWD,G;;;EAtEkCI,gB,UAC5BC,Y,GAAe;AACpBf,UAAQgB;AADY,C;kBADHvB,O","file":"Profile.js","sourcesContent":["// @flow\r\nimport React, { Component } from 'react';\r\nimport Initialize from './Initialize';\r\nimport Subscribe from './Subscribe';\r\nimport Fields from './constants/Fields';\r\nimport LoginStatus from './constants/LoginStatus';\r\n\r\ntype Props = {\r\n  children: Function,\r\n  fields?: string[],\r\n};\r\n\r\ntype State = {\r\n  loading: Boolean,\r\n  profile?: Object,\r\n  error?: Error,\r\n};\r\n\r\nexport default class Profile extends Component<Props, State> {\r\n  static defaultProps = {\r\n    fields: Fields,\r\n  };\r\n\r\n  state: State = {\r\n    loading: true,\r\n  };\r\n\r\n  handleReady = async (api: Object): Promise<void> => {\r\n    this.api = api;\r\n\r\n    this.updateProfile();\r\n  }\r\n\r\n  handleStatusChange = (): void => {\r\n    this.updateProfile();\r\n  }\r\n\r\n  async updateProfile() {\r\n    const { api, props: { fields } } = this;\r\n    if (!api) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await api.getLoginStatus();\r\n      if (response.status !== LoginStatus.CONNECTED) {\r\n        this.setState({\r\n          profile: undefined,\r\n          loading: false,\r\n          error: undefined,\r\n        });\r\n\r\n        return;\r\n      }\r\n\r\n      const profile = await api.getProfile({\r\n        fields,\r\n      });\r\n\r\n      this.setState({\r\n        profile,\r\n        loading: false,\r\n        error: undefined,\r\n      });\r\n    } catch (error) {\r\n      this.setState({\r\n        profile: undefined,\r\n        loading: false,\r\n        error,\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { profile, loading, error } = this.state;\r\n\r\n    return (\r\n      <Initialize onReady={this.handleReady}>\r\n        <Subscribe event=\"auth.statusChange\" onChange={this.handleStatusChange}>\r\n          {children({\r\n            profile,\r\n            loading,\r\n            error,\r\n          })}\r\n        </Subscribe>\r\n      </Initialize>\r\n    );\r\n  }\r\n}\r\n"]}