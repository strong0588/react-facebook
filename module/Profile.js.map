{"version":3,"sources":["../src/Profile.jsx"],"names":["React","Component","Initialize","Subscribe","Fields","LoginStatus","Profile","state","loading","handleReady","api","updateProfile","handleStatusChange","props","fields","response","getLoginStatus","status","CONNECTED","setState","profile","undefined","error","getProfile","render","children","defaultProps"],"mappings":";AACA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,UAAP,MAAuB,cAAvB;AACA,OAAOC,SAAP,MAAsB,aAAtB;AACA,OAAOC,MAAP,MAAmB,oBAAnB;AACA,OAAOC,WAAP,MAAwB,yBAAxB;;AAaA,eAAe,MAAMC,OAAN,SAAsBL,SAAtB,CAA8C;AAAA;AAAA;;AAAA,gDAK3DM,KAL2D,GAK5C;AACbC,eAAS;AADI,KAL4C,OAS3DC,WAT2D;AAAA,mCAS7C,WAAOC,GAAP,EAAsC;AAClD,cAAKA,GAAL,GAAWA,GAAX;;AAEA,cAAKC,aAAL;AACD,OAb0D;;AAAA;AAAA;AAAA;AAAA,eAe3DC,kBAf2D,GAetC,MAAY;AAC/B,WAAKD,aAAL;AACD,KAjB0D;AAAA;;AAmBrDA,eAAN,GAAsB;AAAA;;AAAA;AACpB,YAAM,EAAED,GAAF,EAAOG,OAAO,EAAEC,MAAF,EAAd,KAA6B,MAAnC;AACA,UAAI,CAACJ,GAAL,EAAU;AACR;AACD;;AAED,UAAI;AACF,cAAMK,WAAW,MAAML,IAAIM,cAAJ,EAAvB;AACA,YAAID,SAASE,MAAT,KAAoBZ,YAAYa,SAApC,EAA+C;AAC7C,iBAAKC,QAAL,CAAc;AACZC,qBAASC,SADG;AAEZb,qBAAS,KAFG;AAGZc,mBAAOD;AAHK,WAAd;;AAMA;AACD;;AAED,cAAMD,UAAU,MAAMV,IAAIa,UAAJ,CAAe;AACnCT;AADmC,SAAf,CAAtB;;AAIA,eAAKK,QAAL,CAAc;AACZC,iBADY;AAEZZ,mBAAS,KAFG;AAGZc,iBAAOD;AAHK,SAAd;AAKD,OArBD,CAqBE,OAAOC,KAAP,EAAc;AACd,eAAKH,QAAL,CAAc;AACZC,mBAASC,SADG;AAEZb,mBAAS,KAFG;AAGZc;AAHY,SAAd;AAKD;AAjCmB;AAkCrB;;AAEDE,WAAS;AACP,UAAM,EAAEC,QAAF,KAAe,KAAKZ,KAA1B;AACA,UAAM,EAAEO,OAAF,EAAWZ,OAAX,EAAoBc,KAApB,KAA8B,KAAKf,KAAzC;;AAEA,WACE;AAAC,gBAAD;AAAA,QAAY,SAAS,KAAKE,WAA1B;AACE;AAAC,iBAAD;AAAA,UAAW,OAAM,mBAAjB,EAAqC,UAAU,KAAKG,kBAApD;AACGa,iBAAS;AACRL,iBADQ;AAERZ,iBAFQ;AAGRc;AAHQ,SAAT;AADH;AADF,KADF;AAWD;AAtE0D;AAAxChB,O,CACZoB,Y,GAAe;AACpBZ,UAAQV;AADY,C","file":"Profile.js","sourcesContent":["// @flow\r\nimport React, { Component } from 'react';\r\nimport Initialize from './Initialize';\r\nimport Subscribe from './Subscribe';\r\nimport Fields from './constants/Fields';\r\nimport LoginStatus from './constants/LoginStatus';\r\n\r\ntype Props = {\r\n  children: Function,\r\n  fields?: string[],\r\n};\r\n\r\ntype State = {\r\n  loading: Boolean,\r\n  profile?: Object,\r\n  error?: Error,\r\n};\r\n\r\nexport default class Profile extends Component<Props, State> {\r\n  static defaultProps = {\r\n    fields: Fields,\r\n  };\r\n\r\n  state: State = {\r\n    loading: true,\r\n  };\r\n\r\n  handleReady = async (api: Object): Promise<void> => {\r\n    this.api = api;\r\n\r\n    this.updateProfile();\r\n  }\r\n\r\n  handleStatusChange = (): void => {\r\n    this.updateProfile();\r\n  }\r\n\r\n  async updateProfile() {\r\n    const { api, props: { fields } } = this;\r\n    if (!api) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await api.getLoginStatus();\r\n      if (response.status !== LoginStatus.CONNECTED) {\r\n        this.setState({\r\n          profile: undefined,\r\n          loading: false,\r\n          error: undefined,\r\n        });\r\n\r\n        return;\r\n      }\r\n\r\n      const profile = await api.getProfile({\r\n        fields,\r\n      });\r\n\r\n      this.setState({\r\n        profile,\r\n        loading: false,\r\n        error: undefined,\r\n      });\r\n    } catch (error) {\r\n      this.setState({\r\n        profile: undefined,\r\n        loading: false,\r\n        error,\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { children } = this.props;\r\n    const { profile, loading, error } = this.state;\r\n\r\n    return (\r\n      <Initialize onReady={this.handleReady}>\r\n        <Subscribe event=\"auth.statusChange\" onChange={this.handleStatusChange}>\r\n          {children({\r\n            profile,\r\n            loading,\r\n            error,\r\n          })}\r\n        </Subscribe>\r\n      </Initialize>\r\n    );\r\n  }\r\n}\r\n"]}