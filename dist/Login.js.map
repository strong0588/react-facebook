{"version":3,"sources":["../src/Login.jsx"],"names":["Login","Component","handleClick","evn","preventDefault","handleProcess","onCompleted","onError","props","api","scope","fields","returnScopes","rerequest","reauthorize","eventKey","loginQpts","authType","return_scopes","push","length","auth_type","join","response","login","status","Error","data","getTokenDetailWithProfile","error","render","children","loading","defaultProps","Fields","undefined","ref"],"mappings":";;;;;;;;;;;;;;AACA;;;;AACA;;;;AACA;;;;;;AAkBA,MAAMA,KAAN,SAAoBC,gBAApB,CAAqC;AAAA;AAAA;;AAAA,gDAYnCC,WAZmC;AAAA,iDAYrB,WAAOC,GAAP,EAAe;AAC3BA,YAAIC,cAAJ;;AAEA,cAAM,EAAEC,aAAF,EAAiBC,WAAjB,EAA8BC,OAA9B,KAA0C,MAAKC,KAArD;;AAEA,YAAI;AACF,gBAAMH;AAAA,wDAAc,WAAOI,GAAP,EAAe;AACjC,oBAAM;AACJC,qBADI,EACGC,MADH,EACWC,YADX,EACyBC,SADzB,EACoCC,WADpC,EACiDC;AADjD,kBAEF,MAAKP,KAFT;AAGA,oBAAMQ,YAAY,EAAEN,KAAF,EAAlB;AACA,oBAAMO,WAAW,EAAjB;;AAEA,kBAAIL,YAAJ,EAAkB;AAChBI,0BAAUE,aAAV,GAA0B,IAA1B;AACD;;AAED,kBAAIL,SAAJ,EAAe;AACbI,yBAASE,IAAT,CAAc,WAAd;AACD;;AAED,kBAAIL,WAAJ,EAAiB;AACfG,yBAASE,IAAT,CAAc,gBAAd;AACD;;AAED,kBAAIF,SAASG,MAAb,EAAqB;AACnBJ,0BAAUK,SAAV,GAAsBJ,SAASK,IAAT,CAAc,GAAd,CAAtB;AACD;;AAED,oBAAMC,WAAW,MAAMd,IAAIe,KAAJ,CAAUR,SAAV,CAAvB;AACA,kBAAIO,SAASE,MAAT,KAAoB,WAAxB,EAAqC;AACnC,sBAAM,IAAIC,KAAJ,CAAU,mBAAV,CAAN;AACD;;AAED,oBAAMC,OAAO,MAAMlB,IAAImB,yBAAJ,CAA8B,EAAEjB,MAAF,EAA9B,CAAnB;;AAEA,kBAAIL,WAAJ,EAAiB;AACf,sBAAMA,uCACDqB,IADC;AAEJZ;AAFI,mBAAN;AAID;;AAED,qBAAOY,IAAP;AACD,aAtCK;;AAAA;AAAA;AAAA;AAAA,eAAN;AAuCD,SAxCD,CAwCE,OAAOE,KAAP,EAAc;AACd,cAAItB,OAAJ,EAAa;AACXA,oBAAQsB,KAAR;AACD;AACF;AACF,OA9DkC;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgEnCC,WAAS;AACP,UAAM;AACJC,cADI,EACMC,OADN,EACeH,KADf,EACsBF;AADtB,QAEF,KAAKnB,KAFT;;AAIA,WAAOuB,SAAS;AACdC,aADc;AAEd9B,mBAAa,KAAKA,WAFJ;AAGd2B,WAHc;AAIdF;AAJc,KAAT,CAAP;AAMD;AA3EkC;AAA/B3B,K,CACGiC,Y,GAAe;AACpBvB,SAAO,EADa;AAEpBC,UAAQuB,gBAFY;AAGpBtB,gBAAc,KAHM;AAIpBC,aAAW,KAJS;AAKpBC,eAAa,KALO;AAMpBR,eAAa6B,SANO;AAOpB5B,WAAS4B,SAPW;AAQpBpB,YAAUoB;AARU,C;kBA6ET,uBAAW,CAAC3B,KAAD,EAAQ4B,GAAR,KACxB;AAAC,mBAAD;AAAA;AACG,GAAC;AACAJ,WADA,EACS3B,aADT,EACwBsB,IADxB,EAC8BE;AAD9B,GAAD,KAGC,8BAAC,KAAD,6BACMrB,KADN;AAEE,aAASwB,OAFX;AAGE,mBAAe3B,aAHjB;AAIE,UAAMsB,IAJR;AAKE,WAAOE,KALT;AAME,SAAKO;AANP;AAJJ,CADa,C","file":"Login.js","sourcesContent":["// @flow\r\nimport React, { Component, forwardRef } from 'react';\r\nimport Process from './Process';\r\nimport Fields from './constants/Fields';\r\n\r\ntype Props = {\r\n  children: Function,\r\n  handleProcess: Function,\r\n  loading: boolean,\r\n  data: any,\r\n  error: Error,\r\n  scope?: string,\r\n  fields?: string[],\r\n  returnScopes?: boolean,\r\n  rerequest?: boolean,\r\n  reauthorize?: boolean,\r\n  onCompleted?: Function,\r\n  onError?: Function,\r\n  eventKey?: any,\r\n};\r\n\r\nclass Login extends Component<Props> {\r\n  static defaultProps = {\r\n    scope: '',\r\n    fields: Fields,\r\n    returnScopes: false,\r\n    rerequest: false,\r\n    reauthorize: false,\r\n    onCompleted: undefined,\r\n    onError: undefined,\r\n    eventKey: undefined,\r\n  };\r\n\r\n  handleClick = async (evn) => {\r\n    evn.preventDefault();\r\n\r\n    const { handleProcess, onCompleted, onError } = this.props;\r\n\r\n    try {\r\n      await handleProcess(async (api) => {\r\n        const {\r\n          scope, fields, returnScopes, rerequest, reauthorize, eventKey,\r\n        } = this.props;\r\n        const loginQpts = { scope };\r\n        const authType = [];\r\n\r\n        if (returnScopes) {\r\n          loginQpts.return_scopes = true;\r\n        }\r\n\r\n        if (rerequest) {\r\n          authType.push('rerequest');\r\n        }\r\n\r\n        if (reauthorize) {\r\n          authType.push('reauthenticate');\r\n        }\r\n\r\n        if (authType.length) {\r\n          loginQpts.auth_type = authType.join(',');\r\n        }\r\n\r\n        const response = await api.login(loginQpts);\r\n        if (response.status !== 'connected') {\r\n          throw new Error('Unauthorized user');\r\n        }\r\n\r\n        const data = await api.getTokenDetailWithProfile({ fields });\r\n\r\n        if (onCompleted) {\r\n          await onCompleted({\r\n            ...data,\r\n            eventKey,\r\n          });\r\n        }\r\n\r\n        return data;\r\n      });\r\n    } catch (error) {\r\n      if (onError) {\r\n        onError(error);\r\n      }\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const {\r\n      children, loading, error, data,\r\n    } = this.props;\r\n\r\n    return children({\r\n      loading,\r\n      handleClick: this.handleClick,\r\n      error,\r\n      data,\r\n    });\r\n  }\r\n}\r\n\r\nexport default forwardRef((props, ref) => (\r\n  <Process>\r\n    {({\r\n      loading, handleProcess, data, error,\r\n    }) => (\r\n      <Login\r\n        {...props}\r\n        loading={loading}\r\n        handleProcess={handleProcess}\r\n        data={data}\r\n        error={error}\r\n        ref={ref}\r\n      />\r\n    )}\r\n  </Process>\r\n));\r\n"]}